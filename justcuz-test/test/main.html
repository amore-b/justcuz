<!DOCTYPE html>
<!--add source link-->
<html>
<head>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <!-- Site Properties -->
  <title>Stuff 'n Things</title>

  <!-- replaced sample page links with CDN from https://cdnjs.com/libraries/-->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/reset.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/site.min.css">

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/container.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/grid.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/header.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/image.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/menu.min.css">

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/divider.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/list.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/segment.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/dropdown.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/icon.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/transition.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/button.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/modal.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/dimmer.min.css">  
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/form.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/input.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/card.min.css">
  <link rel="stylesheet" type="text/css" href-"https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/label.min.css">  
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/transition.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/dropdown.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/visibility.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/modal.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/dimmer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/components/form.min.js"></script>  
  <script src="client.js"></script>

  <script>
  $(document)
    .ready(function() {
      var cid, points, cardNum = 0;
      var memName, addy, cardType, email = "";
      // fix main menu to page on passing
      $('.main.menu').visibility({
        type: 'fixed'
      });
      $('.overlay').visibility({
        type: 'fixed',
        offset: 80
      });
      // lazy load images
      $('.image').visibility({
        type: 'image',
        transition: 'vertical flip in',
        duration: 500
      });
      $('.main.menu  .ui.dropdown')
        .dropdown()
      ;
      
      function drawTable(data, value){
        //console.log("IN DRAW TABLE");

        if ((data.length != undefined) && (data.length != 0)) {
          var keys = Object.keys(data[0]);
          console.log(keys);
          var table = $("<table>");
          table.append($("<tr>"));
          for (var i=0; i<keys.length; i++) {
            table.append($("<td><b>"+keys[i]+"</b></td>"));
          }
          table.append($("</tr>"));
          for (var i=0; i< data.length; i++){
            table.append($(drawRow(data[i],keys)));
          }
          table.append($("</table>"));
          table.append($("<br /><p>Filtered by "+ value +"</p>"));
          $('#catalog').html(table);

          var cards = $("<div class= 'ui cards'>");
          for (var j = 0; j < data.length; j++) {
            cards.append($(drawCard(data[j],keys)));
          }
          //close tag
          cards.append($("</div>"));
          $('#catalogtest').html(cards);
        } else {
          //console.log("nothing.");
          drawNoResults();
        }

      }
	
      // labels is an array containing the attribute names
      function drawRow(rowData,labels){
        //$("#catalog").append(row);
        console.log(rowData);
        var row = $("<tr>");
		    row.append($("<td>" + "<a href = 'orderPage.html?inum=" + rowData.ITEM_NUM + "&points=" + points + "&cid="+ cid + "&memName=" + memName +"&email=" + email +"&addy=" + addy + "&cardNum=" + cardNum + "&cardType=" + cardType +"&price="+ rowData.PRICE +"'>" + rowData.ITEM_NUM + "</a>" + "</td>"));
        for (var i=1; i< labels.length; i++) {
          row.append($("<td>" + rowData[labels[i]] + "</td>"));
        }
        row.append($("</tr>"));
        return row;
      }

      function drawCard(cardData, labels) {
        //console.log(cardData);
        var card = $("<a class='card' href='orderPage.html?inum=" + cardData.ITEM_NUM + "&points=" + points + "&cid="+ cid + "&price="+ cardData.PRICE +"'>");
        card.append($("<div class='image'><img src='catalog/" + cardData.ITEM_NUM +".jpg'></div>"));
        card.append($("<div class='header'>" + cardData.ITEM_NUM + "</div>"));
        
        var desc = "";
        if(cardData.GENDER)
          desc += cardData.GENDER + " ";
        if(cardData.COLOR)
          desc += cardData.COLOR + " ";
        if(cardData.TYPE)
          desc += cardData.TYPE + " ";        
        if(cardData.COMPANY_NAME)
          desc += "from " + cardData.COMPANY_NAME;

        card.append($("<div class='content'><div class='meta'>$" + cardData.PRICE + "</div><div class='description'>" + desc + "</div></div></a>"));

        return card;
      }

      function drawNoResults() {
          $('#catalog').html("<p>No results found.</p>");
      }

      $(function() {
          $('.ui.simple.dropdown').dropdown({
            onChange: function(value) {

              //var price = "";
              var type = "";
              var gender = "";
              var color = "";
              var company_name = "";
              var toshow = "";

              if ( $('#all').is( ":checked" )) {
                toshow = "/all";
                console.log("show all");
              } else {
                // if ( $('#price').is( ":checked" )) {
                //   price = "/price";
                //   console.log("show price");
                //   console.log(price);
                // }
                if ( $('#type').is( ":checked" )) {
                  type = "/type";
                  console.log("show type");
                }
                if ( $('#gender').is( ":checked" )) {
                  gender = "/gender";
                  console.log("show gender");
                }
                if ( $('#color').is( ":checked" )) {
                  color = "/color";
                  console.log("show color");
                }
                if ( $('#company_name').is( ":checked" )) {
                  company_name = "/company_name";
                  console.log("show company_name");
                }

                toshow = type + gender + color + company_name;
              
              }
              console.log(value);
              displayMerch(value, toshow);
              /*$.ajax({
                url: "index7.php/merchandise/" + value + toshow,
                success: function(result) {
                    console.log(result);
                    //$('#catalog').html(result);
                    drawTable(result, value);
                },
                error: function() {
                    console.log("nope");
                }
              })*/
            }
          });
      });

      function displayMerch(value, toShow) {
        $.ajax({
          url: "index7.php/merchandise/" + value + toShow ,
          success: function(result) {
              //console.log(result);
              //$('#catalog').html(result);
              drawTable(result, value);
          },
          error: function() {
              console.log("nope");
          }
        })        
      }
     
      $('#loginForm')
        .form({
          fields: {
            email: {
              identifier  : 'email',
              rules: [
                {
                  type   : 'empty',
                  prompt : 'Please enter your e-mail'
                },
                {
                  type   : 'email',
                  prompt : 'Please enter a valid e-mail'
                }
              ]
            },
            password: {
              identifier  : 'password',
              rules: [
                {
                  type   : 'empty',
                  prompt : 'Please enter your password'
                },
                {
                  type   : 'length[6]',//change this
                  prompt : 'Your password must be at least 6 characters'
                }
              ]
            }
          }

        });

        function checkForLoginCookie() {
          var cookie = readCookie("justcuz");
          if(cookie) {
            cid = cookie;
            $.ajax({
              url: "index7.php/users/cid/"+ cid,
              success: function(result) {
                if(result["NAME"]) {
                memName = result["NAME"];
                addy = result["ADDRESS"];
                email = result["EMAIL"];
                cardNum = result["CARD_NUM"];
                cardType = result["CARD_TYPE"];
                console.log(result["NAME"]);
                console.log(result["ADDRESS"]);
                console.log(result["EMAIL"]);
                console.log(result["CARD_NUM"]);
                console.log(result["CARD_TYPE"]);
                createCookie("justcuz", result["CID"], 1);
                console.log(cid);
                points = result["POINTS"];
                console.log(points);
                showLoginButton(false, result["NAME"], result["CID"]);
                }
              },
              error: function() {
                console.log("nope 2");
              }
            })
            //get user info using id
            //replace login button with user icon

          }
        }

        function showLoginButton(show, name) {
          //console.log("yup");
          if(!show) {
            console.log("there");
            $('#loginButton').replaceWith("<div id='userArea'><i class='user icon'></i>" + name + "<a class='ui inverted basic button' href='member.html?value="+cid +"'>Profile</a><button class='ui inverted basic button' id='logoutButton'>Log out</button></div>");
          } else {
            console.log("here too");
            $('#userArea').replaceWith("<button class='ui inverted basic button' id='loginButton'>Log in</button>");
          }
        }

        $('#loginForm').submit(function(e) {
          e.preventDefault();
          
          if($('#loginForm').form('is valid')) {
            var email = $('#loginEmail').val(),
                password = $('#loginPassword').val();

            $.ajax({
              url: "index7.php/users/login",
              type: 'get',
              data: {"email": email, "password": password},
              success: function(result) {
      				if(result["NAME"]) {
      					console.log(result["CID"]);
                createCookie("justcuz", result["CID"], 1);
                points = result["POINTS"];
                cid = readCookie("justcuz");
      					$('#loginModal').modal('hide');
      					showLoginButton(false, result["NAME"]);//, result["CID"]);
                //$('#loginButton').replaceWith("<i class='user icon'></icon>");
                displayMerch("type", "/all");
      				} else {
      					//display login error message
      					console.log(result);
      				}
              //todo: error case
              }
            })
          }
        })

        $('#userNav').on('click', '#logoutButton', function(){
          console.log("stop");
          points = 0;
          eraseCookie("justcuz");
          cid = undefined;
          showLoginButton(true);
          //work-around
          displayMerch("type", "/all");
        });

        $('#userNav').on('click', '#loginButton', function() {
          console.log("rip");
          $('#loginModal').modal('show');
        });

        checkForLoginCookie();
        displayMerch("type", "/all");
    });
  </script>

  <style type="text/css">
  body {
    background-color: #FFFFFF;
  }
  .main.container {
    margin-top: 7em;
  }
  .main.menu {
    margin-top: 4em;
    border-radius: 0;
    border: none;
    box-shadow: none;
    transition:
      box-shadow 0.5s ease,
      padding 0.5s ease
    ;
  }
  .main.menu .item img.logo {
    margin-right: 1.5em;
  }
  .overlay {
    float: left;
    margin: 0em 3em 1em 0em;
  }
  .overlay .menu {
    position: relative;
    left: 0;
    transition: left 0.5s ease;
  }
  .main.menu.fixed {
    background-color: #FFFFFF;
    border: 1px solid #DDD;
    box-shadow: 0px 3px 5px rgba(0, 0, 0, 0.2);
  }
  .overlay.fixed .menu {
    left: 800px;
  }
  .text.container .left.floated.image {
    margin: 2em 2em 2em -4em;
  }
  .text.container .right.floated.image {
    margin: 2em -4em 2em 2em;
  }
  .ui.footer.segment {
    margin: 5em 0em 0em;
    padding: 5em 0em;
  }
  .ui.segment {
    box-shadow: 0px 0px 0px rgba(0, 0, 0, 0);
    border: 0px;
  }
  .ui.stacked.segment {
    box-shadow: 0px 0px 0px rgba(0, 0, 0, 0);
  }
  .ui.stacked.segment:after {
    border-top: 0px;
    height: 0;
  }
  .ui.error.message {
    text-align: left;
  }
  </style>

</head>
<body>
  <div class="ui fixed inverted menu">
    <div class="ui container">
      <a href="#" class="header item">
        <img class="logo" src="assets/images/logo.png">
        Stuff n' Things
      </a>
      <a href="#" class="item">Home</a>
      <div class="ui simple dropdown item">

        Filter merchandise by: <i class="dropdown icon"></i>
          <div class="menu">
            <div class="item">
              <i class="dropdown icon"></i>
              Type
              <div class="menu">
                <div class="item" data-value="type/all">All</div>
                <div class="item" data-value="type/jeans">Jeans</div>
                <div class="item" data-value="type/shirt">Shirts</div>
                <div class="item" data-value="type/shoes">Shoes</div>
                <div class="item" data-value="type/purse">Purses</div>
                <div class="item" data-value="type/sweater">Sweaters</div>
              </div>
            </div>

            <div class="item">
              <i class="dropdown icon"></i>
              Gender
              <div class="menu">
                <div class="item" data-value="gender/all">All</div>
                <div class="item" data-value="gender/M">Men</div>
                <div class="item" data-value="gender/W">Women</div>
                <div class="item" data-value="gender/U">Unisex</div>
              </div>
            </div>
            
            <div class="item">
              <i class="dropdown icon"></i>
              Color
              <div class="menu">
                <div class="item" data-value="color/all">All</div>
                <div class="item" data-value="color/blue">Blue</div>
                <div class="item" data-value="color/pink">Pink</div>
                <div class="item" data-value="color/white">White</div>
                <div class="item" data-value="color/black">Black</div>
                <div class="item" data-value="color/orange">Orange</div>
              </div>
            </div>
          </div>

      </div>
      <div class="right item">
        <div id="userNav"><button class="ui inverted basic button" id="loginButton">Log in</button></div>
      </div>
    </div>
  </div>

  <div class="ui main text container">
    <h1 class="ui header">Stuff n' Things</h1>
  </div>
  <a href = "employee.html#" class="item">Employees Only</a>
  <a href = "manager.html#" class="item">Managers Only</a>

  <div class="ui text container">
    <b>First, select which columns to show (Item_Num and Price are always shown):</b>
<!--     <div class="ui checkbox">
      <input id="price" tabindex="0" class="hidden" type="checkbox">
      <label>Price</label>
    </div> -->
    <div class="ui checkbox">
      <input id="type" tabindex="0" class="hidden" type="checkbox">
      <label>Type</label>
    </div>
    <div class="ui checkbox">
      <input id="gender" tabindex="0" class="hidden" type="checkbox">
      <label>Gender</label>
    </div>
    <div class="ui checkbox">
      <input id="color" tabindex="0" class="hidden" type="checkbox">
      <label>Color</label>
    </div>
    <div class="ui checkbox">
      <input id="company_name" tabindex="0" class="hidden" type="checkbox">
      <label>Company_Name</label>
    </div>
    <div class="ui checkbox">
      <input id="all" tabindex="0" class="hidden" type="checkbox">
      <label>All</label>
    </div>
  </div>


  <div class="ui text container" id="catalog"></div>
  <div class="ui text container" id="catalogtest"></div>

  <div class="ui inverted vertical footer segment">
    <div class="ui center aligned container">
      <img src="assets/images/logo.png" class="ui centered mini image">
      <div class="ui horizontal inverted small divided link list">
        <a class="item" href="#">Site Map</a>
        <a class="item" href="#">Contact Us</a>
        <a class="item" href="#">Terms and Conditions</a>
        <a class="item" href="#">Privacy Policy</a>
      </div>
    </div>
  </div>

  <div class="ui modal" id="loginModal">
    <i class="close icon"></i>
    <div class="header">
      <div class="ui middle aligned center aligned grid">
      <div class="column">
        <h2 class="ui teal header">
          <div class="content">
            Log in to your account
          </div>
        </h2>
      </div>
    </div>
    </div>
    <div class="ui middle aligned center aligned grid">
      <div class="column">
        <form class="ui large form" id="loginForm" > <!--action="index7.php/users/login" method="post"-->
          <div class="ui stacked segment">
            <div class="field">
              <div class="ui left icon input">
                <i class="user icon"></i>
                <input type="text" name="email" placeholder="Email address" id="loginEmail">
              </div>
            </div>
            <div class="field">
              <div class="ui left icon input">
                <i class="lock icon"></i>
                <input type="password" name="password" placeholder="Password" id="loginPassword">
              </div>
            </div>
            <div class="ui error message"></div>
            <div class="ui teal submit button">Log in</div>        
          </div>
        </form>
      </div>
    </div>
    <div class="actions">
      <div class="ui middle aligned center aligned grid">
        <div class="ui message">
          New to us? <a href="#">Sign Up</a>
        </div>
      </div>
    </div>
  </div>
</body>
